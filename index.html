<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dataleaks API Tester</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    input, select { width: 100%; max-width: 400px; margin-bottom: 1em; }
    pre { background: #f7f7f7; padding: 1em; border-radius: 6px; }
    .result { margin-top: 2em; }
    label { font-weight: bold; }
    button { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Dataleaks Backend API Tester</h1>
  <form id="apiForm">
    <label for="query">Enter Query (phone number):</label><br>
    <input type="text" id="query" name="query" required>
    <label for="limit">Limit:</label><br>
    <input type="number" id="limit" name="limit" value="100" min="1" max="1000">
    <label for="lang">Language:</label><br>
    <select id="lang" name="lang">
      <option value="en">English</option>
      <option value="ru">Russian</option>
      <option value="es">Spanish</option>
    </select>
    <label for="type">Type:</label><br>
    <select id="type" name="type">
      <option value="json">JSON</option>
      <option value="text">Text</option>
    </select>
    <button type="submit">Send Query</button>
  </form>

  <div class="result" id="result"></div>

  <script>
    document.getElementById('apiForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const query = document.getElementById('query').value;
      const limit = document.getElementById('limit').value;
      const lang = document.getElementById('lang').value;
      const type = document.getElementById('type').value;
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = "Loading...";
      try {
        const response = await fetch('/.netlify/functions/query', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({query, limit, lang, type})
        });
        const text = await response.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (jsonErr) {
          resultDiv.innerHTML = `<pre style="color:red;">Response was not valid JSON:<br>${text}</pre>`;
          return;
        }
        if (data.error) {
          resultDiv.innerHTML = `<pre style="color:red;">Error: ${data.error}${data.detail ? "\nDetails: " + data.detail : ""}</pre>`;
        } else {
          resultDiv.innerHTML =
            `<h3>Summary:</h3><pre>${data.summary || 'N/A'}</pre>
             <h3>Raw Response:</h3><pre>${typeof data.raw === "object" ? JSON.stringify(data.raw, null, 2) : data.raw}</pre>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<pre style="color:red;">Request failed: ${err}</pre>`;
      }
    });
  </script>
</body>
</html>
